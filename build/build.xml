<project default="standardBuild" basedir=".">
	<property environment="env" />
	<property name="src" value="src" />
	<property name="cls" value="bin" />
	<property name="dist" value="dist" />
	<property name="res" value="ressourcen" />
	<property name="keystore" value="/home/coalado/Desktop/jDownloader.keystore" />
	<!-- plugins that serialize ohn classes have to be put in the classpath -->
	<property name="class-path" value="libs/Filters.jar libs/JTattoo.jar plugins/JDPackageCustomizer.jar plugins/schedule.jar libs/JUnique.jar libs/jna.jar libs/JDGUI.jar libs/JDHttp.jar libs/JAntiCaptcha.jar libs/JDUtils.jar libs/BrowserLauncher2.jar libs/clink170.jar libs/cobra.jar libs/hsqldb.jar libs/htmlcleaner2_0.jar libs/irclib.jar libs/js.jar libs/looks.jar libs/mail.jar libs/miglayout.jar libs/savemytube.jar libs/laf/substance-swingx.jar libs/laf/substance.jar libs/svnkit.jar libs/swingworker.jar libs/swingx.jar libs/ui.jar libs/laf/synthetica.jar libs/laf/syntheticaBatik.jar libs/laf/syntheticaBlackMoon.jar libs/laf/syntheticaBlackStar.jar libs/laf/syntheticaBlueIce.jar libs/laf/syntheticaBlueMoon.jar libs/laf/syntheticaBlueSteel.jar libs/laf/syntheticaGreenDream.jar libs/laf/syntheticaMauveMetallic.jar libs/laf/syntheticaOrangeMetallic.jar libs/laf/syntheticaBlackEye.jar libs/laf/syntheticaGreenDream.jar libs/laf/syntheticaSilverMoon.jar libs/laf/syntheticaSimple2D.jar libs/laf/syntheticaSkyMetallic.jar libs/laf/syntheticaWhiteVision.jar" />

	<target name="compile">
		<mkdir dir="${cls}" />
		<javac srcdir="${src}" destdir="${cls}" encoding="UTF-8" source="1.5" target="1.5" />
	</target>

	<target name="jar">
		<!-- jDownloader -->
		<manifest file="Manifest.MF">
			<attribute name="Created-By" value="JD-Team and AppWork UG" />
			<attribute name="Main-Class" value="jd.Main" />
			<attribute name="Class-Path" value="${class-path}" />
		</manifest>
		<mkdir dir="${dist}" />
		<jar jarfile="${dist}/JDownloader.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="**/*.class" />
				<exclude name="jd/http/**" />
				<exclude name="jd/captcha/**" />
				<exclude name="jd/gui/**" />
				<exclude name="it/**" />
				<exclude name="jd/nutils/**" />
				<exclude name="jd/plugins/hoster/**" />
				<exclude name="jd/dynamics/**" />
				<exclude name="jd/plugins/decrypter/**" />
				<exclude name="jd/captcha/methods/**" />
				<exclude name="jd/plugins/optional/**" />
				<exclude name="sun/net/www/protocol/**" />
				<include name="jd/plugins/hoster/HTTPAllgemein*" />
				<exclude name="tests/**" />
			</fileset>
			<fileset dir="${res}">
				<include name="*.properties" />
				<exclude name="jd/captcha/methods" />
			</fileset>
		</jar>
		<delete file="Manifest.MF" failonerror="false" />

		<manifest file="Manifest.MF">
			<attribute name="Created-By" value="JD-Team and AppWork UG." />
			<attribute name="Class-Path" value="${class-path}" />
		</manifest>

		<mkdir dir="${dist}/libs" />
		<jar jarfile="${dist}/libs/JUnique.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="it/**" />
			</fileset>
		</jar>
		<delete file="Manifest.MF" failonerror="false" />

		<manifest file="Manifest.MF">
			<attribute name="Created-By" value="JD-Team and AppWork UG" />
			<attribute name="Class-Path" value="${class-path}" />
		</manifest>

		<mkdir dir="${dist}/libs" />
		<jar jarfile="${dist}/libs/JDHttp.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/http/**" />
				<include name="sun/net/www/protocol/**" />
			</fileset>
		</jar>

		<jar jarfile="${dist}/libs/JDGUI.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/gui/**" />
			</fileset>
		</jar>

		<jar jarfile="${dist}/libs/JAntiCaptcha.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/captcha/**" />
				<exclude name="jd/captcha/methods/**" />
			</fileset>

		</jar>

		<jar jarfile="${dist}/libs/JDUtils.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/nutils/**" />
			</fileset>
		</jar>
		<delete file="Manifest.MF" failonerror="false" />
	</target>

	<target name="jarWebupdater">
		<!--Webupdater-->
		<manifest file="Manifest.MF">
			<attribute name="Created-By" value="coalado" />
			<attribute name="Main-Class" value="jd.update.Main" />
		</manifest>
		<jar jarfile="${dist}/jdupdate.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/update/*.class" />
				<include name="jd/config/*.class" />
				<include name="jd/http/**" />
				<include name="jd/event/**" />
				<include name="jd/controlling/**" />
				<include name="jd/nutils/**" />
				<include name="jd/JDClassLoader.class" />
				<include name="jd/utils/*.class" />
				<include name="jd/plugins/PluginException.class" />
				<include name="sun/net/www/protocol/jdps/*.class" />
				<include name="jd/parser/Regex.class" />
				<include name="sun/net/www/protocol/jdp/*.class" />
			</fileset>
			<zipfileset src="ressourcen/libs/hsqldb.jar" excludes="META-INF/*" />
		</jar>
		<delete file="Manifest.MF" failonerror="false" />
	</target>
	<target name="jarRestarter">
		<!--Restarter-->
		<manifest file="Manifest.MF">
			<attribute name="Created-By" value="coalado" />
			<attribute name="Main-Class" value="jd.update.Restarter" />
		</manifest>
		<jar jarfile="${dist}/tinyupdate.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/update/Restarter*.class" />
				<include name="jd/nutils/OutdatedParser*.class" />
				<include name="jd/nutils/OSDetector*.class" />
				<include name="jd/nutils/DynByteBuff*.class" />
				<include name="jd/nutils/Executer*.class" />
				<include name="jd/nutils/zip/**" />
				<include name="jd/parser/Regex*.class" />
			</fileset>
		</jar>
		<delete file="Manifest.MF" failonerror="false" />
	</target>

	<target name="jarOptionals">
		<!-- Optional Plugins -->
		<manifest file="Manifest.MF">
			<attribute name="Created-By" value="JD-Team" />
		</manifest>

		<mkdir dir="${dist}/pluginressourcen/100__JDChat/plugins" />
		<jar jarfile="${dist}/pluginressourcen/100__JDChat/plugins/JDChat.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/jdchat/**" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/101__JDwebinterface/plugins" />
		<jar jarfile="${dist}/pluginressourcen/101__JDwebinterface/plugins/JDWebinterface.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/webinterface/**" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/104__JDRemoteControl/plugins" />
		<jar jarfile="${dist}/pluginressourcen/104__JDRemoteControl/plugins/JDRemoteControl.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/JDRemoteControl*" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/105__JDScheduler/plugins" />
		<jar jarfile="${dist}/pluginressourcen/105__JDScheduler/plugins/schedule.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/schedule/**" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/106__JDShutdown/plugins" />
		<jar jarfile="${dist}/pluginressourcen/106__JDShutdown/plugins/JDShutdown.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/JDShutdown*" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/117__JDHttpLiveScripter/plugins" />
		<jar jarfile="${dist}/pluginressourcen/117__JDHttpLiveScripter/plugins/JDHTTPLiveHeaderScripter.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/HTTPLiveHeaderScripter*" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/120__JDLangFileEditor/plugins" />
		<jar jarfile="${dist}/pluginressourcen/120__JDLangFileEditor/plugins/JDLangFileEditor.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/langfileeditor/**" />
			</fileset>
		</jar>



		<mkdir dir="${dist}/pluginressourcen/122__JDInfoFileWriter/plugins" />
		<jar jarfile="${dist}/pluginressourcen/122__JDInfoFileWriter/plugins/JDInfoFileWriter.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/JDInfoFileWriter*" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/123__JDUnrar/plugins" />
		<jar jarfile="${dist}/pluginressourcen/123__JDUnrar/plugins/JDUnrar.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/jdunrar/**" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/127__JDHJMerge/plugins" />
		<jar jarfile="${dist}/pluginressourcen/127__JDHJMerge/plugins/JDHJMerge.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/hjsplit/**" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/128__JDTray/plugins" />
		<jar jarfile="${dist}/pluginressourcen/128__JDTray/plugins/JDTray.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/jdtrayicon/**" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/129__ExternInterface/plugins" />
		<jar jarfile="${dist}/pluginressourcen/129__ExternInterface/plugins/JDExternInterface.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/interfaces/**" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/130__JDPremium/plugins" />
		<jar jarfile="${dist}/pluginressourcen/130__JDPremium/plugins/JDPremium.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/premcol/**" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/131__JDGrowl/plugins" />
		<jar jarfile="${dist}/pluginressourcen/131__JDGrowl/plugins/JDGrowl.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/JDGrowlNotification*" />
			</fileset>
		</jar>

		<mkdir dir="${dist}/pluginressourcen/132__Customizer/plugins" />
		<jar jarfile="${dist}/pluginressourcen/132__Customizer/plugins/JDPackageCustomizer.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/customizer/**" />
			</fileset>
		</jar>
		<mkdir dir="${dist}/pluginressourcen/133__AntiShutdown/plugins" />
		<jar jarfile="${dist}/pluginressourcen/133__AntiShutdown/plugins/JDAntiShutdown.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/antistandby/**" />
			</fileset>
		</jar>
		<mkdir dir="${dist}/pluginressourcen/134__RouterDBEditor/plugins" />
		<jar jarfile="${dist}/pluginressourcen/134__RouterDBEditor/plugins/JDRouterDBEditor.jar" manifest="Manifest.MF">
			<fileset dir="${cls}">
				<include name="jd/plugins/optional/routerdbeditor/**" />
			</fileset>
		</jar>
		
		<mkdir dir="${dist}/pluginressourcen/135__RouterSend/plugins" />
			<jar jarfile="${dist}/pluginressourcen/135__RouterSend/plugins/RouterSend.jar" manifest="Manifest.MF">
				<fileset dir="${cls}">
					<include name="jd/plugins/optional/routersend/**" />
				</fileset>
			</jar>

		<property name="addonnumber" value="136" />
		<property name="package" value="proxyrot" />
		<mkdir dir="${dist}/pluginressourcen/${addonnumber}__${package}/plugins" />
				<jar jarfile="${dist}/pluginressourcen/${addonnumber}__${package}/plugins/${package}.jar" manifest="Manifest.MF">
					<fileset dir="${cls}">
						<include name="jd/plugins/optional/${package}/**" />
					</fileset>
				</jar>
	</target>

	<target name="sign">
		<signjar keystore="${keystore}" alias="jDownloader" storepass="jDownloader">
			<path>
				<fileset dir="${dist}" includes="**/*.jar" />
			</path>
		</signjar>
	</target>

	<target name="cryptContainer">
		<taskdef name="yguard" classname="com.yworks.yguard.YGuardTask" />
		<yguard>
			<inoutpair in="${dist}/JDownloader.jar" out="${dist}/JDownloader_obfuscated.jar" />
			<rename>
				<keep>
					<field name="serialVersionUID" />
					<method name="void readObject(java.io.ObjectInputStream)" />
					<method name="void writeObject(java.io.ObjectOutputStream)" />

					<class implements="java.io.Serializable" classes="private" methods="private" fields="private" />

					<class extends="jd.plugins.Plugin" />
					<class classes="protected" methods="protected" fields="protected" />
					<class classes="public" methods="public" fields="public" />
				</keep>
			</rename>
		</yguard>
		<delete file="${dist}/JDownloader.jar" failonerror="no" />
		<move file="${dist}/JDownloader_obfuscated.jar" tofile="${dist}/JDownloader.jar" />
	</target>

	<target name="standardBuild" depends="compile,jar,jarOptionals,jarWebupdater,jarRestarter">
	</target>



	<target name="dlcEnabledBuild" depends="standardBuild,cryptContainer,sign">
	</target>

	<target name="signedBuild" depends="standardBuild,sign">
	</target>

</project>